Indices:
  - index_name: files
    type: neo4j
    mapping:
      id:
        type: keyword
      pid:
        type: keyword
      file_id:
        type: keyword
      guid:
        type: keyword
      file_name:
        type: keyword
      file_category:
        type: keyword
      file_type:
        type: keyword
      file_description:
        type: keyword
      file_size:
        type: long
      md5sum:
        type: keyword
      study_id:
        type: keyword
      dbgap_accession:
        type: keyword
      study_acronym:
        type: keyword
      study_name:
        type: keyword
      participant_id:
        type: keyword
      sample_id:
        type: keyword
      files:
        type: text
        fields:
          keyword:
            type: keyword
      combined_filters:
        type: nested
        properties:
          participant_id:
            type: keyword
          race:
            type: keyword
          sex_at_birth:
            type: keyword
          survival_filters:
            type: nested
            properties:
              last_known_survival_status:
                type: keyword
              age_at_event_free_survival_status:
                type: integer
              event_free_survival_status:
                type: keyword
              first_event:
                type: keyword
          treatment_filters:
            type: nested
            properties:
              treatment_type:
                type: keyword
              treatment_agent:
                type: keyword
              age_at_treatment_start:
                type: integer
          treatment_response_filters:
            type: nested
            properties:
              response_category:
                type: keyword
              age_at_response:
                type: integer
          sample_diagnosis_filters:
            type: nested
            properties:
              sample_anatomic_site:
                type: keyword
              participant_age_at_collection:
                type: integer
              sample_tumor_status:
                type: keyword
              tumor_classification:
                type: keyword
              age_at_diagnosis:
                type: integer
              diagnosis_anatomic_site:
                type: keyword
              disease_phase:
                type: keyword
              diagnosis_classification_system:
                type: keyword
              diagnosis_basis:
                type: keyword
              tumor_grade_source:
                type: keyword  
              tumor_stage_source:
                type: keyword   
              diagnosis:
                type: keyword
      participant_filters:
        type: nested
        properties:
          race:
            type: keyword
          sex_at_birth:
            type: keyword
      sample_diagnosis_filters:
        type: nested
        properties:
          sample_anatomic_site:
            type: keyword
          participant_age_at_collection:
            type: integer
          sample_tumor_status:
            type: keyword
          tumor_classification:
            type: keyword
          age_at_diagnosis:
            type: integer
          diagnosis_anatomic_site:
            type: keyword
          disease_phase:
            type: keyword
          diagnosis_classification_system:
            type: keyword
          diagnosis_basis:
            type: keyword
          tumor_grade_source:
            type: keyword  
          tumor_stage_source:
            type: keyword   
          diagnosis:
            type: keyword
      survival_filters:
        type: nested
        properties:
          last_known_survival_status:
            type: keyword
          age_at_event_free_survival_status:
            type: integer
          event_free_survival_status:
            type: keyword
          first_event:
            type: keyword
      treatment_filters:
        type: nested
        properties:
          treatment_type:
            type: keyword
          treatment_agent:
            type: keyword
          age_at_treatment_start:
            type: integer
      treatment_response_filters:
        type: nested
        properties:
          response_category:
            type: keyword
          age_at_response:
            type: integer
      library_selection:
        type: keyword
        fields:
          sort:
            type: keyword
            normalizer: lowercase
      library_source_material:
        type: keyword
        fields:
          sort:
            type: keyword
            normalizer: lowercase
      library_source_molecule:
        type: keyword
        fields:
          sort:
            type: keyword
            normalizer: lowercase
      library_strategy:
        type: keyword
        fields:
          sort:
            type: keyword
            normalizer: lowercase
    # Cypher query will be used to retrieve data from Neo4j, and index into Elasticsearch
    cypher_queries:
      - query: |
          MATCH (file)
          where (file:clinical_measure_file or file:radiology_file)
          MATCH (p:participant)<--(file)
          optional MATCH (p)<-[*0..3]-(sm:sample)
          OPTIONAL MATCH (p)<-[:of_diagnosis]-(dg:diagnosis)
          with file, COLLECT(DISTINCT {
                                        sample_anatomic_site: apoc.text.split(sm.anatomic_site, ';'),
                                        participant_age_at_collection: sm.participant_age_at_collection,
                                        sample_tumor_status: sm.sample_tumor_status,
                                        tumor_classification: sm.tumor_classification,
                                        age_at_diagnosis: dg.age_at_diagnosis,
                                        diagnosis_anatomic_site: apoc.text.split(dg.anatomic_site, ';'),
                                        disease_phase: dg.disease_phase,
                                        diagnosis_classification_system: dg.diagnosis_classification_system,
                                        diagnosis_basis: dg.diagnosis_basis,
                                        tumor_grade_source: dg.tumor_grade_source,
                                        tumor_stage_source: dg.tumor_stage_source,
                                        diagnosis: dg.diagnosis
                                    }) AS sample_diagnosis_filter_1
          MATCH (p:participant)<--(file)
          optional MATCH (p)<-[:of_sample]-(sm:sample)
          OPTIONAL MATCH (sm)<--(dg:diagnosis)
          with file, sample_diagnosis_filter_1, COLLECT(DISTINCT {
                                        sample_anatomic_site: apoc.text.split(sm.anatomic_site, ';'),
                                        participant_age_at_collection: sm.participant_age_at_collection,
                                        sample_tumor_status: sm.sample_tumor_status,
                                        tumor_classification: sm.tumor_classification,
                                        age_at_diagnosis: dg.age_at_diagnosis,
                                        diagnosis_anatomic_site: apoc.text.split(dg.anatomic_site, ';'),
                                        disease_phase: dg.disease_phase,
                                        diagnosis_classification_system: dg.diagnosis_classification_system,
                                        diagnosis_basis: dg.diagnosis_basis,
                                        tumor_grade_source: dg.tumor_grade_source,
                                        tumor_stage_source: dg.tumor_stage_source,
                                        diagnosis: dg.diagnosis
                                    }) AS sample_diagnosis_filter_2
          with file, apoc.coll.union(sample_diagnosis_filter_1, sample_diagnosis_filter_2) as sample_diagnosis_filter_3
          MATCH (p:participant)<--(file)
          optional MATCH (p)<-[:of_sample]-(sm1:sample)<-[*2..2]-(sm:sample)
          OPTIONAL MATCH (sm1)<--(dg:diagnosis)
          with file, sample_diagnosis_filter_3, COLLECT(DISTINCT {
                                        sample_anatomic_site: apoc.text.split(sm.anatomic_site, ';'),
                                        participant_age_at_collection: sm.participant_age_at_collection,
                                        sample_tumor_status: sm.sample_tumor_status,
                                        tumor_classification: sm.tumor_classification,
                                        age_at_diagnosis: dg.age_at_diagnosis,
                                        diagnosis_anatomic_site: apoc.text.split(dg.anatomic_site, ';'),
                                        disease_phase: dg.disease_phase,
                                        diagnosis_classification_system: dg.diagnosis_classification_system,
                                        diagnosis_basis: dg.diagnosis_basis,
                                        tumor_grade_source: dg.tumor_grade_source,
                                        tumor_stage_source: dg.tumor_stage_source,
                                        diagnosis: dg.diagnosis
                                    }) AS sample_diagnosis_filter_4
          with file, apoc.coll.union(sample_diagnosis_filter_3, sample_diagnosis_filter_4) as sample_diagnosis_filter_5
          MATCH (p:participant)<--(file)
          optional MATCH (p)<-[:of_sample]-(sm1:sample)<-[*2..2]-(sm:sample)
          OPTIONAL MATCH (sm)<--(dg:diagnosis)
          with file, sample_diagnosis_filter_5, apoc.coll.union(COLLECT(DISTINCT {
                                        sample_anatomic_site: apoc.text.split(sm1.anatomic_site, ';'),
                                        participant_age_at_collection: sm1.participant_age_at_collection,
                                        sample_tumor_status: sm1.sample_tumor_status,
                                        tumor_classification: sm1.tumor_classification,
                                        age_at_diagnosis: dg.age_at_diagnosis,
                                        diagnosis_anatomic_site: apoc.text.split(dg.anatomic_site, ';'),
                                        disease_phase: dg.disease_phase,
                                        diagnosis_classification_system: dg.diagnosis_classification_system,
                                        diagnosis_basis: dg.diagnosis_basis,
                                        tumor_grade_source: dg.tumor_grade_source,
                                        tumor_stage_source: dg.tumor_stage_source,
                                        diagnosis: dg.diagnosis
                                    }), COLLECT(DISTINCT {
                                        sample_anatomic_site: apoc.text.split(sm.anatomic_site, ';'),
                                        participant_age_at_collection: sm.participant_age_at_collection,
                                        sample_tumor_status: sm.sample_tumor_status,
                                        tumor_classification: sm.tumor_classification,
                                        age_at_diagnosis: dg.age_at_diagnosis,
                                        diagnosis_anatomic_site: apoc.text.split(dg.anatomic_site, ';'),
                                        disease_phase: dg.disease_phase,
                                        diagnosis_classification_system: dg.diagnosis_classification_system,
                                        diagnosis_basis: dg.diagnosis_basis,
                                        tumor_grade_source: dg.tumor_grade_source,
                                        tumor_stage_source: dg.tumor_stage_source,
                                        diagnosis: dg.diagnosis
                                    })) AS sample_diagnosis_filter_6
          with file, apoc.coll.union(sample_diagnosis_filter_5, sample_diagnosis_filter_6) as sample_diagnosis_filter
          MATCH (p:participant)<--(file)
          MATCH (st:study)<-[:of_participant]-(p)
          OPTIONAL MATCH (st)<-[:of_publication]-(pub:publication)
          OPTIONAL MATCH (p)<-[:of_survival]-(su:survival)
          OPTIONAL MATCH (p)<-[:of_treatment]-(tm:treatment)
          OPTIONAL MATCH (p)<-[:of_treatment_response]-(tr:treatment_response)
          OPTIONAL MATCH (st)<-[:of_study_personnel]-(stp:study_personnel)
          OPTIONAL MATCH (st)<-[:of_study_funding]-(stf:study_funding)
          with file, p, st, sample_diagnosis_filter,COLLECT(DISTINCT {last_known_survival_status: su.last_known_survival_status, 
              event_free_survival_status: su.event_free_survival_status, 
              first_event: su.first_event,
              age_at_event_free_survival_status: su.age_at_event_free_survival_status} ) AS survival_filters,
            COLLECT(DISTINCT{treatment_type: tm.treatment_type,
            treatment_agent: tm.treatment_agent,
            age_at_treatment_start: tm.age_at_treatment_start}) as treatment_filters,
            COLLECT(DISTINCT{response_category: tr.response_category,
            age_at_response: tr.age_at_response}) as treatment_response_filters
          RETURN DISTINCT
            file.id as id,
            p.id as pid,
            CASE LABELS(file)[0]
                  WHEN 'clinical_measure_file' THEN file.clinical_measure_file_id
                  WHEN 'radiology_file' THEN file.radiology_file_id
                  ELSE null END AS file_id,
            file.dcf_indexd_guid AS guid,
            file.file_name AS file_name,
            CASE labels(file)[0] WHEN 'clinical_measure_file' THEN 'Clinical data'
                                      WHEN 'radiology_file' THEN 'Radiology imaging'
                                      ELSE null END AS file_category,
            file.file_type AS file_type,
            file.file_description AS file_description,
            file.file_size AS file_size,
            file.md5sum AS md5sum,
            st.study_id AS study_id,
            st.dbgap_accession as dbgap_accession,
            st.study_acronym as study_acronym,
            st.study_name as study_name,
            p.participant_id AS participant_id,
            null AS sample_id,
            COLLECT(DISTINCT file.id) as files,
            null as combined_filters,
            COLLECT(DISTINCT {
              race: apoc.text.split(p.race, ';'),
              sex_at_birth: p.sex_at_birth
            }) AS participant_filters,
            sample_diagnosis_filter AS sample_diagnosis_filters,
            survival_filters as survival_filters,  
            treatment_filters as treatment_filters,
            treatment_response_filters as treatment_response_filters,
            null AS library_selection,
            null AS library_source_material,
            null AS library_source_molecule,
            null AS library_strategy
      - query: |
          MATCH (st:study)<-[:of_clinical_measure_file]-(file:clinical_measure_file)
          OPTIONAL MATCH (st)<-[:of_participant]-(p)
          optional MATCH (p)<-[*0..3]-(sm:sample)
          OPTIONAL MATCH (p)<-[:of_diagnosis]-(dg:diagnosis)
          with file, p, COLLECT(DISTINCT {
                                        sample_anatomic_site: apoc.text.split(sm.anatomic_site, ';'),
                                        participant_age_at_collection: sm.participant_age_at_collection,
                                        sample_tumor_status: sm.sample_tumor_status,
                                        tumor_classification: sm.tumor_classification,
                                        age_at_diagnosis: dg.age_at_diagnosis,
                                        diagnosis_anatomic_site: apoc.text.split(dg.anatomic_site, ';'),
                                        disease_phase: dg.disease_phase,
                                        diagnosis_classification_system: dg.diagnosis_classification_system,
                                        diagnosis_basis: dg.diagnosis_basis,
                                        tumor_grade_source: dg.tumor_grade_source,
                                        tumor_stage_source: dg.tumor_stage_source,
                                        diagnosis: dg.diagnosis
                                    }) AS sample_diagnosis_filter_1
          match (st:study)<--(p)
          match (st)<--(file)
          optional MATCH (p)<-[:of_sample]-(sm:sample)
          OPTIONAL MATCH (sm)<--(dg:diagnosis)
          with file, p, sample_diagnosis_filter_1, COLLECT(DISTINCT {
                                        sample_anatomic_site: apoc.text.split(sm.anatomic_site, ';'),
                                        participant_age_at_collection: sm.participant_age_at_collection,
                                        sample_tumor_status: sm.sample_tumor_status,
                                        tumor_classification: sm.tumor_classification,
                                        age_at_diagnosis: dg.age_at_diagnosis,
                                        diagnosis_anatomic_site: apoc.text.split(dg.anatomic_site, ';'),
                                        disease_phase: dg.disease_phase,
                                        diagnosis_classification_system: dg.diagnosis_classification_system,
                                        diagnosis_basis: dg.diagnosis_basis,
                                        tumor_grade_source: dg.tumor_grade_source,
                                        tumor_stage_source: dg.tumor_stage_source,
                                        diagnosis: dg.diagnosis
                                    }) AS sample_diagnosis_filter_2
          with file, p, apoc.coll.union(sample_diagnosis_filter_1, sample_diagnosis_filter_2) as sample_diagnosis_filter_3
          match (st:study)<--(p)
          match (st)<--(file)
          optional MATCH (p)<-[:of_sample]-(sm1:sample)<-[*2..2]-(sm:sample)
          OPTIONAL MATCH (sm1)<--(dg:diagnosis)
          with file, p, sample_diagnosis_filter_3, COLLECT(DISTINCT {
                                        sample_anatomic_site: apoc.text.split(sm.anatomic_site, ';'),
                                        participant_age_at_collection: sm.participant_age_at_collection,
                                        sample_tumor_status: sm.sample_tumor_status,
                                        tumor_classification: sm.tumor_classification,
                                        age_at_diagnosis: dg.age_at_diagnosis,
                                        diagnosis_anatomic_site: apoc.text.split(dg.anatomic_site, ';'),
                                        disease_phase: dg.disease_phase,
                                        diagnosis_classification_system: dg.diagnosis_classification_system,
                                        diagnosis_basis: dg.diagnosis_basis,
                                        tumor_grade_source: dg.tumor_grade_source,
                                        tumor_stage_source: dg.tumor_stage_source,
                                        diagnosis: dg.diagnosis
                                    }) AS sample_diagnosis_filter_4
          with file, p, apoc.coll.union(sample_diagnosis_filter_3, sample_diagnosis_filter_4) as sample_diagnosis_filter_5
          MATCH (st:study)<-[:of_clinical_measure_file]-(file)
          OPTIONAL MATCH (st)<-[:of_participant]-(p)
          optional MATCH (p)<-[:of_sample]-(sm1:sample)<-[*2..2]-(sm:sample)
          OPTIONAL MATCH (sm)<--(dg:diagnosis)
          OPTIONAL MATCH (p)<-[:of_survival]-(su:survival)
          OPTIONAL MATCH (p)<-[:of_treatment]-(tm:treatment)
          OPTIONAL MATCH (p)<-[:of_treatment_response]-(tr:treatment_response)
          with file, p, sample_diagnosis_filter_5, apoc.coll.union(COLLECT(DISTINCT {
                                        sample_anatomic_site: apoc.text.split(sm1.anatomic_site, ';'),
                                        participant_age_at_collection: sm1.participant_age_at_collection,
                                        sample_tumor_status: sm1.sample_tumor_status,
                                        tumor_classification: sm1.tumor_classification,
                                        age_at_diagnosis: dg.age_at_diagnosis,
                                        diagnosis_anatomic_site: apoc.text.split(dg.anatomic_site, ';'),
                                        disease_phase: dg.disease_phase,
                                        diagnosis_classification_system: dg.diagnosis_classification_system,
                                        diagnosis_basis: dg.diagnosis_basis,
                                        tumor_grade_source: dg.tumor_grade_source,
                                        tumor_stage_source: dg.tumor_stage_source,
                                        diagnosis: dg.diagnosis
                                    }), COLLECT(DISTINCT {
                                        sample_anatomic_site: apoc.text.split(sm.anatomic_site, ';'),
                                        participant_age_at_collection: sm.participant_age_at_collection,
                                        sample_tumor_status: sm.sample_tumor_status,
                                        tumor_classification: sm.tumor_classification,
                                        age_at_diagnosis: dg.age_at_diagnosis,
                                        diagnosis_anatomic_site: apoc.text.split(dg.anatomic_site, ';'),
                                        disease_phase: dg.disease_phase,
                                        diagnosis_classification_system: dg.diagnosis_classification_system,
                                        diagnosis_basis: dg.diagnosis_basis,
                                        tumor_grade_source: dg.tumor_grade_source,
                                        tumor_stage_source: dg.tumor_stage_source,
                                        diagnosis: dg.diagnosis
                                    })) AS sample_diagnosis_filter_6, COLLECT(DISTINCT {last_known_survival_status: su.last_known_survival_status, 
              event_free_survival_status: su.event_free_survival_status, 
              first_event: su.first_event,
              age_at_event_free_survival_status: su.age_at_event_free_survival_status} ) AS survival_filters,
            COLLECT(DISTINCT{treatment_type: tm.treatment_type,
            treatment_agent: tm.treatment_agent,
            age_at_treatment_start: tm.age_at_treatment_start}) as treatment_filters,
            COLLECT(DISTINCT{response_category: tr.response_category,
            age_at_response: tr.age_at_response}) as treatment_response_filters
          with file, p, apoc.coll.union(sample_diagnosis_filter_5, sample_diagnosis_filter_6) as sample_diagnosis_filter, survival_filters,  treatment_filters, treatment_response_filters
          with file, collect(DISTINCT {
                participant_id: p.participant_id,
                race: apoc.text.split(p.race, ';'),
                sex_at_birth: p.sex_at_birth,
                sample_diagnosis_filters: sample_diagnosis_filter,
                survival_filters: survival_filters,
                treatment_filters: treatment_filters,
                treatment_response_filters: treatment_response_filters
            }) as combined_filter_1
          MATCH (st:study)<-[:of_clinical_measure_file]-(file)
          OPTIONAL MATCH (st)<--(cl)<--(sm:sample)
          where (cl: cell_line or cl: pdx)
          OPTIONAL MATCH (sm)<--(dg:diagnosis)
          with file, combined_filter_1, COLLECT(DISTINCT {
                                        sample_anatomic_site: apoc.text.split(sm.anatomic_site, ';'),
                                        participant_age_at_collection: sm.participant_age_at_collection,
                                        sample_tumor_status: sm.sample_tumor_status,
                                        tumor_classification: sm.tumor_classification,
                                        age_at_diagnosis: dg.age_at_diagnosis,
                                        diagnosis_anatomic_site: apoc.text.split(dg.anatomic_site, ';'),
                                        disease_phase: dg.disease_phase,
                                        diagnosis_classification_system: dg.diagnosis_classification_system,
                                        diagnosis_basis: dg.diagnosis_basis,
                                        tumor_grade_source: dg.tumor_grade_source,
                                        tumor_stage_source: dg.tumor_stage_source,
                                        diagnosis: dg.diagnosis
                                    }) as sample_diagnosis_filter
          with file, combined_filter_1, collect({
                participant_id: null,
                race: null,
                sex_at_birth: null,
                sample_diagnosis_filters: sample_diagnosis_filter 
          }) as combined_filter_2
          with file, apoc.coll.union(combined_filter_1, combined_filter_2) as combined_filter
          MATCH (st:study)<-[:of_clinical_measure_file]-(file)
          OPTIONAL MATCH (st)<-[:of_publication]-(pub:publication)
          OPTIONAL MATCH (st)<-[:of_study_personnel]-(stp:study_personnel)
          OPTIONAL MATCH (st)<-[:of_study_funding]-(stf:study_funding)
          With file, st, combined_filter, stf, stp
          RETURN DISTINCT
            file.id as id,
            null as pid,
            file.clinical_measure_file_id AS file_id,
            file.dcf_indexd_guid AS guid,
            file.file_name AS file_name,
            'Clinical data' AS file_category,
            file.file_type AS file_type,
            file.file_description AS file_description,
            file.file_size AS file_size,
            file.md5sum AS md5sum,
            st.study_id AS study_id,
            st.dbgap_accession as dbgap_accession,
            st.study_acronym as study_acronym,
            st.study_name as study_name,
            null AS participant_id,
            null AS sample_id,
            COLLECT(DISTINCT file.id) as files,
            combined_filter as combined_filters,
            null as participant_filters,
            null as sample_diagnosis_filters,
            null as survival_filters,
            null as treatment_filters,
            null as treatment_response_filters,
            null AS library_selection,
            null AS library_source_material,
            null AS library_source_molecule,
            null AS library_strategy
      - query: |
          MATCH (file)
          where (file: sequencing_file OR file:pathology_file OR file:methylation_array_file OR file:cytogenomic_file)
          MATCH (p:participant)<-[*..3]-(sm:sample)<--(file)
          with file, sm, p
          SKIP $skip LIMIT $limit
          OPTIONAL MATCH (p)<-[:of_diagnosis]-(dg:diagnosis)
          with file, COLLECT(DISTINCT {
                                        sample_anatomic_site: apoc.text.split(sm.anatomic_site, ';'),
                                        participant_age_at_collection: sm.participant_age_at_collection,
                                        sample_tumor_status: sm.sample_tumor_status,
                                        tumor_classification: sm.tumor_classification,
                                        age_at_diagnosis: dg.age_at_diagnosis,
                                        diagnosis_anatomic_site: apoc.text.split(dg.anatomic_site, ';'),
                                        disease_phase: dg.disease_phase,
                                        diagnosis_classification_system: dg.diagnosis_classification_system,
                                        diagnosis_basis: dg.diagnosis_basis,
                                        tumor_grade_source: dg.tumor_grade_source,
                                        tumor_stage_source: dg.tumor_stage_source,
                                        diagnosis: dg.diagnosis
                                    }) AS sample_diagnosis_filter_1
          optional MATCH (p:participant)<-[:of_sample]-(sm:sample)<--(file)
          OPTIONAL MATCH (sm)<--(dg:diagnosis)
          with file, sample_diagnosis_filter_1, COLLECT(DISTINCT {
                                        sample_anatomic_site: apoc.text.split(sm.anatomic_site, ';'),
                                        participant_age_at_collection: sm.participant_age_at_collection,
                                        sample_tumor_status: sm.sample_tumor_status,
                                        tumor_classification: sm.tumor_classification,
                                        age_at_diagnosis: dg.age_at_diagnosis,
                                        diagnosis_anatomic_site: apoc.text.split(dg.anatomic_site, ';'),
                                        disease_phase: dg.disease_phase,
                                        diagnosis_classification_system: dg.diagnosis_classification_system,
                                        diagnosis_basis: dg.diagnosis_basis,
                                        tumor_grade_source: dg.tumor_grade_source,
                                        tumor_stage_source: dg.tumor_stage_source,
                                        diagnosis: dg.diagnosis
                                    }) AS sample_diagnosis_filter_2
          with file, apoc.coll.union(sample_diagnosis_filter_1, sample_diagnosis_filter_2) as sample_diagnosis_filter_3
          optional MATCH (p:participant)<-[:of_sample]-(sm1:sample)<-[*2..2]-(sm:sample)<--(file)
          OPTIONAL MATCH (sm1)<--(dg:diagnosis)
          with file, sample_diagnosis_filter_3, apoc.coll.union(COLLECT(DISTINCT {
                                        sample_anatomic_site: apoc.text.split(sm1.anatomic_site, ';'),
                                        participant_age_at_collection: sm1.participant_age_at_collection,
                                        sample_tumor_status: sm1.sample_tumor_status,
                                        tumor_classification: sm1.tumor_classification,
                                        age_at_diagnosis: dg.age_at_diagnosis,
                                        diagnosis_anatomic_site: apoc.text.split(dg.anatomic_site, ';'),
                                        disease_phase: dg.disease_phase,
                                        diagnosis_classification_system: dg.diagnosis_classification_system,
                                        diagnosis_basis: dg.diagnosis_basis,
                                        tumor_grade_source: dg.tumor_grade_source,
                                        tumor_stage_source: dg.tumor_stage_source,
                                        diagnosis: dg.diagnosis
                                    }), COLLECT(DISTINCT {
                                        sample_anatomic_site: apoc.text.split(sm.anatomic_site, ';'),
                                        participant_age_at_collection: sm.participant_age_at_collection,
                                        sample_tumor_status: sm.sample_tumor_status,
                                        tumor_classification: sm.tumor_classification,
                                        age_at_diagnosis: dg.age_at_diagnosis,
                                        diagnosis_anatomic_site: apoc.text.split(dg.anatomic_site, ';'),
                                        disease_phase: dg.disease_phase,
                                        diagnosis_classification_system: dg.diagnosis_classification_system,
                                        diagnosis_basis: dg.diagnosis_basis,
                                        tumor_grade_source: dg.tumor_grade_source,
                                        tumor_stage_source: dg.tumor_stage_source,
                                        diagnosis: dg.diagnosis
                                    })) AS sample_diagnosis_filter_4
          with file, apoc.coll.union(sample_diagnosis_filter_3, sample_diagnosis_filter_4) as sample_diagnosis_filter_5
          optional MATCH (p:participant)<-[:of_sample]-(sm1:sample)<-[*2..2]-(sm:sample)<--(file)
          OPTIONAL MATCH (sm)<--(dg:diagnosis)
          with file, sample_diagnosis_filter_5, apoc.coll.union(COLLECT(DISTINCT {
                                        sample_anatomic_site: apoc.text.split(sm1.anatomic_site, ';'),
                                        participant_age_at_collection: sm1.participant_age_at_collection,
                                        sample_tumor_status: sm1.sample_tumor_status,
                                        tumor_classification: sm1.tumor_classification,
                                        age_at_diagnosis: dg.age_at_diagnosis,
                                        diagnosis_anatomic_site: apoc.text.split(dg.anatomic_site, ';'),
                                        disease_phase: dg.disease_phase,
                                        diagnosis_classification_system: dg.diagnosis_classification_system,
                                        diagnosis_basis: dg.diagnosis_basis,
                                        tumor_grade_source: dg.tumor_grade_source,
                                        tumor_stage_source: dg.tumor_stage_source,
                                        diagnosis: dg.diagnosis
                                    }), COLLECT(DISTINCT {
                                        sample_anatomic_site: apoc.text.split(sm.anatomic_site, ';'),
                                        participant_age_at_collection: sm.participant_age_at_collection,
                                        sample_tumor_status: sm.sample_tumor_status,
                                        tumor_classification: sm.tumor_classification,
                                        age_at_diagnosis: dg.age_at_diagnosis,
                                        diagnosis_anatomic_site: apoc.text.split(dg.anatomic_site, ';'),
                                        disease_phase: dg.disease_phase,
                                        diagnosis_classification_system: dg.diagnosis_classification_system,
                                        diagnosis_basis: dg.diagnosis_basis,
                                        tumor_grade_source: dg.tumor_grade_source,
                                        tumor_stage_source: dg.tumor_stage_source,
                                        diagnosis: dg.diagnosis
                                    })) AS sample_diagnosis_filter_6
          with file, apoc.coll.union(sample_diagnosis_filter_5, sample_diagnosis_filter_6) as sample_diagnosis_filter
          MATCH (p:participant)<-[:of_sample]-(sm1:sample)<-[*0..2]-(sm:sample)<--(file)
          MATCH (st:study)<-[:of_participant]-(p)
          OPTIONAL MATCH (st)<-[:of_publication]-(pub:publication)
          OPTIONAL MATCH (p)<-[:of_survival]-(su:survival)
          OPTIONAL MATCH (p)<-[:of_treatment]-(tm:treatment)
          OPTIONAL MATCH (p)<-[:of_treatment_response]-(tr:treatment_response)
          OPTIONAL MATCH (st)<-[:of_study_personnel]-(stp:study_personnel)
          OPTIONAL MATCH (st)<-[:of_study_funding]-(stf:study_funding)
          with file, p, sample_diagnosis_filter, sm1, sm, st, COLLECT(DISTINCT {last_known_survival_status: su.last_known_survival_status, 
              event_free_survival_status: su.event_free_survival_status, 
              first_event: su.first_event,
              age_at_event_free_survival_status: su.age_at_event_free_survival_status} ) AS survival_filters,
            COLLECT(DISTINCT{treatment_type: tm.treatment_type,
            treatment_agent: tm.treatment_agent,
            age_at_treatment_start: tm.age_at_treatment_start}) as treatment_filters,
            COLLECT(DISTINCT{response_category: tr.response_category,
            age_at_response: tr.age_at_response}) as treatment_response_filters, stf, stp 
          RETURN DISTINCT
            file.id as id,
            p.id as pid,
            CASE LABELS(file)[0]
                  WHEN 'sequencing_file' THEN file.sequencing_file_id
                  WHEN 'cytogenomic_file' THEN file.cytogenomic_file_id
                  WHEN 'pathology_file' THEN file.pathology_file_id
                  WHEN 'methylation_array_file' THEN file.methylation_array_file_id ELSE null END AS file_id,
            file.dcf_indexd_guid AS guid,
            file.file_name AS file_name,
            CASE LABELS(file)[0] WHEN 'sequencing_file' THEN 'Sequencing'
                                    WHEN 'cytogenomic_file' THEN 'Cytogenomic'
                                    WHEN 'pathology_file' THEN 'Pathology imaging'
                                    WHEN 'methylation_array_file' THEN 'Methylation array' 
                                    ELSE null END AS file_category,
            file.file_type AS file_type,
            file.file_description AS file_description,
            file.file_size AS file_size,
            file.md5sum AS md5sum,
            st.study_id AS study_id,
            st.dbgap_accession as dbgap_accession,
            st.study_acronym as study_acronym,
            st.study_name as study_name,
            p.participant_id AS participant_id,
            CASE sm1.sample_id WHEN sm.sample_id THEN sm.sample_id
                      ELSE sm1.sample_id + ',' + sm.sample_id END AS sample_id,
            COLLECT(DISTINCT file.id) as files,
            null as combined_filters,
            COLLECT(DISTINCT {
                race: apoc.text.split(p.race, ';'),
                sex_at_birth: p.sex_at_birth
            }) AS participant_filters,
            sample_diagnosis_filter AS sample_diagnosis_filters,
            survival_filters as survival_filters,
            treatment_filters as treatment_filters,
            treatment_response_filters as treatment_response_filters,
            CASE LABELS(file)[0] WHEN 'sequencing_file' THEN file.library_selection
                                        ELSE null END AS library_selection,
            CASE LABELS(file)[0] WHEN 'sequencing_file' THEN file.library_source_material
                                        ELSE null END AS library_source_material,
            CASE LABELS(file)[0] WHEN 'sequencing_file' THEN file.library_source_molecule
                                        ELSE null END AS library_source_molecule,
            CASE LABELS(file)[0] WHEN 'sequencing_file' THEN file.library_strategy
                                        ELSE null END AS library_strategy
        page_size: 10000
      - query: |
          MATCH (file)
          WHERE (file:sequencing_file OR file:pathology_file OR file:methylation_array_file OR file:cytogenomic_file)
          MATCH (st:study)<-[:of_cell_line|of_pdx]-(cl)<--(sm:sample)
          Where (cl: cell_line or cl: pdx)
          MATCH (sm)<--(file)
          optional match (sm)<--(dg:diagnosis)
          OPTIONAL MATCH (st)<-[:of_publication]-(pub:publication)
          OPTIONAL MATCH (st)<-[:of_study_personnel]-(stp:study_personnel)
          OPTIONAL MATCH (st)<-[:of_study_funding]-(stf:study_funding)
          with file, sm, st, dg, stf, stp
          RETURN DISTINCT
            file.id as id,
            null as pid,
            CASE LABELS(file)[0]
                  WHEN 'sequencing_file' THEN file.sequencing_file_id
                  WHEN 'cytogenomic_file' THEN file.cytogenomic_file_id
                  WHEN 'pathology_file' THEN file.pathology_file_id
                  WHEN 'methylation_array_file' THEN file.methylation_array_file_id ELSE null END AS file_id,
            file.dcf_indexd_guid AS guid,
            file.file_name AS file_name,
            CASE LABELS(file)[0]
                  WHEN 'sequencing_file' THEN 'Sequencing'
                  WHEN 'cytogenomic_file' THEN 'Cytogenomic'
                  WHEN 'pathology_file' THEN 'Pathology imaging'
                  WHEN 'methylation_array_file' THEN 'Methylation array' ELSE null END AS file_category,
            file.file_type AS file_type,
            file.file_description AS file_description,
            file.file_size AS file_size,
            file.md5sum AS md5sum,
            st.study_id AS study_id,
            st.dbgap_accession as dbgap_accession,
            st.study_acronym as study_acronym,
            st.study_name as study_name,
            null AS participant_id,
            sm.sample_id AS sample_id,
            COLLECT(DISTINCT file.id) as files,
            null as combined_filters,
            null AS participant_filters,
            COLLECT(DISTINCT {
                sample_anatomic_site: apoc.text.split(sm.anatomic_site, ';'),
                participant_age_at_collection: sm.participant_age_at_collection,
                sample_tumor_status: sm.sample_tumor_status,
                tumor_classification: sm.tumor_classification,
                age_at_diagnosis: dg.age_at_diagnosis,
                diagnosis_anatomic_site: apoc.text.split(dg.anatomic_site, ';'),
                disease_phase: dg.disease_phase,
                diagnosis_classification_system: dg.diagnosis_classification_system,
                diagnosis_basis: dg.diagnosis_basis,
                tumor_grade_source: dg.tumor_grade_source,
                tumor_stage_source: dg.tumor_stage_source,
                diagnosis: dg.diagnosis
            }) AS sample_diagnosis_filters, 
            null as survival_filters,
            null as treatment_filters,
            null as treatment_response_filters,
            CASE LABELS(file)[0]
                      WHEN 'sequencing_file' THEN file.library_selection
                      ELSE null END AS library_selection,
            CASE LABELS(file)[0] WHEN 'sequencing_file' THEN file.library_source_material
                                        ELSE null END AS library_source_material,
            CASE LABELS(file)[0] WHEN 'sequencing_file' THEN file.library_source_molecule
                                        ELSE null END AS library_source_molecule,
            CASE LABELS(file)[0]
                      WHEN 'sequencing_file' THEN file.library_strategy
                      ELSE null END AS library_strategy
      - query: |
         MATCH (st:study)<--(p:participant)<--(sm1:sample)<-[*2..2]-(sm:sample)
          where not ((sm)<--(:sequencing_file)) and not ((sm)<--(:cytogenomic_file)) and not ((sm)<--(:pathology_file)) and not ((sm)<--(:methylation_array_file)) and not ((p)<--(:radiology_file)) and not ((p)<--(:clinical_measure_file))
          OPTIONAL MATCH (p)<-[:of_diagnosis]-(dg:diagnosis)
          with p, sm1, sm, apoc.coll.union(COLLECT(DISTINCT {
                                sample_anatomic_site: apoc.text.split(sm1.anatomic_site, ';'),
                                participant_age_at_collection: sm1.participant_age_at_collection,
                                sample_tumor_status: sm1.sample_tumor_status,
                                tumor_classification: sm1.tumor_classification,
                                age_at_diagnosis: dg.age_at_diagnosis,
                                diagnosis_anatomic_site: apoc.text.split(dg.anatomic_site, ';'),
                                disease_phase: dg.disease_phase,
                                diagnosis_classification_system: dg.diagnosis_classification_system,
                                diagnosis_basis: dg.diagnosis_basis,
                                tumor_grade_source: dg.tumor_grade_source,
                                tumor_stage_source: dg.tumor_stage_source,
                                diagnosis: dg.diagnosis
                            }), COLLECT(DISTINCT {
                                sample_anatomic_site: apoc.text.split(sm.anatomic_site, ';'),
                                participant_age_at_collection: sm.participant_age_at_collection,
                                sample_tumor_status: sm.sample_tumor_status,
                                tumor_classification: sm.tumor_classification,
                                age_at_diagnosis: dg.age_at_diagnosis,
                                diagnosis_anatomic_site: apoc.text.split(dg.anatomic_site, ';'),
                                disease_phase: dg.disease_phase,
                                diagnosis_classification_system: dg.diagnosis_classification_system,
                                diagnosis_basis: dg.diagnosis_basis,
                                tumor_grade_source: dg.tumor_grade_source,
                                tumor_stage_source: dg.tumor_stage_source,
                                diagnosis: dg.diagnosis
                            })) as sample_diagnosis_filter_1
          MATCH (st:study)<--(p)<--(sm1)<-[*2..2]-(sm)
          where not ((sm)<--(:sequencing_file)) and not ((sm)<--(:cytogenomic_file)) and not ((sm)<--(:pathology_file)) and not ((sm)<--(:methylation_array_file)) and not ((p)<--(:radiology_file)) and not ((p)<--(:clinical_measure_file))
          OPTIONAL MATCH (sm1)<--(dg:diagnosis)
          with p, sm1, sm, sample_diagnosis_filter_1, apoc.coll.union(COLLECT(DISTINCT {
                                sample_anatomic_site: apoc.text.split(sm1.anatomic_site, ';'),
                                participant_age_at_collection: sm1.participant_age_at_collection,
                                sample_tumor_status: sm1.sample_tumor_status,
                                tumor_classification: sm1.tumor_classification,
                                age_at_diagnosis: dg.age_at_diagnosis,
                                diagnosis_anatomic_site: apoc.text.split(dg.anatomic_site, ';'),
                                disease_phase: dg.disease_phase,
                                diagnosis_classification_system: dg.diagnosis_classification_system,
                                diagnosis_basis: dg.diagnosis_basis,
                                tumor_grade_source: dg.tumor_grade_source,
                                tumor_stage_source: dg.tumor_stage_source,
                                diagnosis: dg.diagnosis
                            }), COLLECT(DISTINCT {
                                sample_anatomic_site: apoc.text.split(sm.anatomic_site, ';'),
                                participant_age_at_collection: sm.participant_age_at_collection,
                                sample_tumor_status: sm.sample_tumor_status,
                                tumor_classification: sm.tumor_classification,
                                age_at_diagnosis: dg.age_at_diagnosis,
                                diagnosis_anatomic_site: apoc.text.split(dg.anatomic_site, ';'),
                                disease_phase: dg.disease_phase,
                                diagnosis_classification_system: dg.diagnosis_classification_system,
                                diagnosis_basis: dg.diagnosis_basis,
                                tumor_grade_source: dg.tumor_grade_source,
                                tumor_stage_source: dg.tumor_stage_source,
                                diagnosis: dg.diagnosis
                            })) AS sample_diagnosis_filter_2
          with p, sm1, sm, apoc.coll.union(sample_diagnosis_filter_1, sample_diagnosis_filter_2) as sample_diagnosis_filter_3
          MATCH (st:study)<--(p)<--(sm1)<-[*2..2]-(sm)
          where not ((sm)<--(:sequencing_file)) and not ((sm)<--(:cytogenomic_file)) and not ((sm)<--(:pathology_file)) and not ((sm)<--(:methylation_array_file)) and not ((p)<--(:radiology_file)) and not ((p)<--(:clinical_measure_file))
          OPTIONAL MATCH (sm)<--(dg:diagnosis)
          with p, sm1, sm, sample_diagnosis_filter_3, apoc.coll.union(COLLECT(DISTINCT {
                                sample_anatomic_site: apoc.text.split(sm1.anatomic_site, ';'),
                                participant_age_at_collection: sm1.participant_age_at_collection,
                                sample_tumor_status: sm1.sample_tumor_status,
                                tumor_classification: sm1.tumor_classification,
                                age_at_diagnosis: dg.age_at_diagnosis,
                                diagnosis_anatomic_site: apoc.text.split(dg.anatomic_site, ';'),
                                disease_phase: dg.disease_phase,
                                diagnosis_classification_system: dg.diagnosis_classification_system,
                                diagnosis_basis: dg.diagnosis_basis,
                                tumor_grade_source: dg.tumor_grade_source,
                                tumor_stage_source: dg.tumor_stage_source,
                                diagnosis: dg.diagnosis
                            }), COLLECT(DISTINCT {
                                sample_anatomic_site: apoc.text.split(sm.anatomic_site, ';'),
                                participant_age_at_collection: sm.participant_age_at_collection,
                                sample_tumor_status: sm.sample_tumor_status,
                                tumor_classification: sm.tumor_classification,
                                age_at_diagnosis: dg.age_at_diagnosis,
                                diagnosis_anatomic_site: apoc.text.split(dg.anatomic_site, ';'),
                                disease_phase: dg.disease_phase,
                                diagnosis_classification_system: dg.diagnosis_classification_system,
                                diagnosis_basis: dg.diagnosis_basis,
                                tumor_grade_source: dg.tumor_grade_source,
                                tumor_stage_source: dg.tumor_stage_source,
                                diagnosis: dg.diagnosis
                            })) AS sample_diagnosis_filter_4
          with p, sm1, sm, apoc.coll.union(sample_diagnosis_filter_3, sample_diagnosis_filter_4) as sample_diagnosis_filter
          MATCH (st:study)<--(p)<--(sm1)<-[*2..2]-(sm)
          OPTIONAL MATCH (p)<-[:of_survival]-(su:survival)
          OPTIONAL MATCH (p)<-[:of_treatment]-(tm:treatment)
          OPTIONAL MATCH (p)<-[:of_treatment_response]-(tr:treatment_response)
          OPTIONAL MATCH (st)<-[:of_study_personnel]-(stp:study_personnel)
          OPTIONAL MATCH (st)<-[:of_study_funding]-(stf:study_funding)
          with distinct p, sm, st, sample_diagnosis_filter, COLLECT(DISTINCT {last_known_survival_status: su.last_known_survival_status, 
              event_free_survival_status: su.event_free_survival_status, 
              first_event: su.first_event,
              age_at_event_free_survival_status: su.age_at_event_free_survival_status} ) AS survival_filters,
            COLLECT(DISTINCT{treatment_type: tm.treatment_type,
            treatment_agent: tm.treatment_agent,
            age_at_treatment_start: tm.age_at_treatment_start}) as treatment_filters,
            COLLECT(DISTINCT{response_category: tr.response_category,
            age_at_response: tr.age_at_response}) as treatment_response_filters, stf, stp
          RETURN DISTINCT
            null as id,
            p.id as pid,
            null AS file_id,
            null AS guid,
            null AS file_name,
            null AS file_category,
            null AS file_type,
            null AS file_description,
            null AS file_size,
            null AS md5sum,
            st.study_id AS study_id,
            st.dbgap_accession as dbgap_accession,
            st.study_acronym as study_acronym,
            st.study_name as study_name,
            p.participant_id AS participant_id,
            sm.sample_id AS sample_id,
            null as files,
            null as combined_filters,
            COLLECT(DISTINCT {
                race: apoc.text.split(p.race, ';'),
                sex_at_birth: p.sex_at_birth
            }) AS participant_filters,
            sample_diagnosis_filter as sample_diagnosis_filter,
            survival_filters as survival_filters,
            treatment_filters as treatment_filters,
            treatment_response_filters as treatment_response_filters,
            null AS library_selection,
            null AS library_source_material,
            null AS library_source_molecule,
            null AS library_strategy
      - query: |
          MATCH (st:study)<--(p:participant)<--(sm:sample)
          where not ((sm)<-[*..3]-(:sequencing_file)) and not ((sm)<-[*..3]-(:cytogenomic_file)) and not ((sm)<-[*..3]-(:pathology_file)) and not ((sm)<-[*..3]-(:methylation_array_file)) and not ((p)<--(:radiology_file)) and not ((p)<--(:clinical_measure_file))
          OPTIONAL MATCH (p)<-[*..2]-(dg:diagnosis)
          OPTIONAL MATCH (p)<-[:of_survival]-(su:survival)
          OPTIONAL MATCH (p)<-[:of_treatment]-(tm:treatment)
          OPTIONAL MATCH (p)<-[:of_treatment_response]-(tr:treatment_response)
          OPTIONAL MATCH (st)<-[:of_study_personnel]-(stp:study_personnel)
          OPTIONAL MATCH (st)<-[:of_study_funding]-(stf:study_funding)
          with sm, p, st, dg, COLLECT(DISTINCT {last_known_survival_status: su.last_known_survival_status, 
              event_free_survival_status: su.event_free_survival_status, 
              first_event: su.first_event,
              age_at_event_free_survival_status: su.age_at_event_free_survival_status} ) AS survival_filters,
            COLLECT(DISTINCT{treatment_type: tm.treatment_type,
            treatment_agent: tm.treatment_agent,
            age_at_treatment_start: tm.age_at_treatment_start}) as treatment_filters,
            COLLECT(DISTINCT{response_category: tr.response_category,
            age_at_response: tr.age_at_response}) as treatment_response_filters, stf, stp
          RETURN DISTINCT
            null as id,
            p.id as pid,
            null AS file_id,
            null AS guid,
            null AS file_name,
            null AS file_category,
            null AS file_type,
            null AS file_description,
            null AS file_size,
            null AS md5sum,
            st.study_id AS study_id,
            st.dbgap_accession as dbgap_accession,
            st.study_acronym as study_acronym,
            st.study_name as study_name, 
            p.participant_id AS participant_id,
            sm.sample_id AS sample_id,
            null as files,
            null as combined_filters,
            COLLECT(DISTINCT {
                race: apoc.text.split(p.race, ';'),
                sex_at_birth: p.sex_at_birth
            }) AS participant_filters,
            COLLECT(DISTINCT {
                sample_anatomic_site: apoc.text.split(sm.anatomic_site, ';'),
                participant_age_at_collection: sm.participant_age_at_collection,
                sample_tumor_status: sm.sample_tumor_status,
                tumor_classification: sm.tumor_classification,
                age_at_diagnosis: dg.age_at_diagnosis,
                diagnosis_anatomic_site: apoc.text.split(dg.anatomic_site, ';'),
                disease_phase: dg.disease_phase,
                diagnosis_classification_system: dg.diagnosis_classification_system,
                diagnosis_basis: dg.diagnosis_basis,
                tumor_grade_source: dg.tumor_grade_source,
                tumor_stage_source: dg.tumor_stage_source,
                diagnosis: dg.diagnosis
            }) AS sample_diagnosis_filters,
            survival_filters as survival_filters,
            treatment_filters as treatment_filters,
            treatment_response_filters as treatment_response_filters,
            null AS library_selection,
            null AS library_source_material,
            null AS library_source_molecule,
            null AS library_strategy
      - query: |
          MATCH (st:study)<--(cl)<--(sm:sample)
          Where (cl: cell_line or cl: pdx) and not ((sm)<--(:sequencing_file)) and not ((sm)<--(:cytogenomic_file)) and not ((sm)<--(:pathology_file)) and not ((sm)<--(:methylation_array_file))
          optional match (sm)<--(dg:diagnosis)
          OPTIONAL MATCH (st)<-[:of_study_personnel]-(stp:study_personnel)
          OPTIONAL MATCH (st)<-[:of_study_funding]-(stf:study_funding)
          with sm, dg, st, stf, stp
          RETURN DISTINCT
            null as id,
            null as pid,
            null AS file_id,
            null AS guid,
            null AS file_name,
            null AS file_category,
            null AS file_type,
            null AS file_description,
            null AS file_size,
            null AS md5sum,
            st.study_id AS study_id,
            st.dbgap_accession as dbgap_accession,
            st.study_acronym as study_acronym,
            st.study_name as study_name,
            null AS participant_id,
            sm.sample_id AS sample_id,
            null as files,
            null as combined_filters,
            null AS participant_filters,
            null as survival_filters,
            null as treatment_filters,
            null as treatment_response_filters,
            COLLECT(DISTINCT {
                sample_anatomic_site: apoc.text.split(sm.anatomic_site, ';'),
                participant_age_at_collection: sm.participant_age_at_collection,
                sample_tumor_status: sm.sample_tumor_status,
                tumor_classification: sm.tumor_classification,
                age_at_diagnosis: null,
                diagnosis_anatomic_site: null,
                disease_phase: null,
                diagnosis_classification_system: null,
                diagnosis_basis: null,
                tumor_grade_source: null,
                tumor_stage_source: null,
                diagnosis_classification: null
            }) AS sample_diagnosis_filters,
            null AS library_selection,
            null AS library_source_material,
            null AS library_source_molecule,
            null AS library_strategy
      - query: |
          MATCH (st:study)<--(p:participant)
          where not ((p)<--(:sample)) and not ((p)<--(:radiology_file)) and not ((p)<--(:clinical_measure_file))
          OPTIONAL MATCH (p)<-[:of_diagnosis]-(dg:diagnosis)
          OPTIONAL MATCH (p)<-[:of_survival]-(su:survival)
          OPTIONAL MATCH (p)<-[:of_treatment]-(tm:treatment)
          OPTIONAL MATCH (p)<-[:of_treatment_response]-(tr:treatment_response)
          OPTIONAL MATCH (st)<-[:of_study_personnel]-(stp:study_personnel)
          OPTIONAL MATCH (st)<-[:of_study_funding]-(stf:study_funding)
          with p, st, dg, COLLECT(DISTINCT {last_known_survival_status: su.last_known_survival_status, 
              event_free_survival_status: su.event_free_survival_status, 
              first_event: su.first_event,
              age_at_event_free_survival_status: su.age_at_event_free_survival_status} ) AS survival_filters,
            COLLECT(DISTINCT{treatment_type: tm.treatment_type,
            treatment_agent: tm.treatment_agent,
            age_at_treatment_start: tm.age_at_treatment_start}) as treatment_filters,
            COLLECT(DISTINCT{response_category: tr.response_category,
            age_at_response: tr.age_at_response}) as treatment_response_filters, stf, stp          
          RETURN DISTINCT
            null as id,
            p.id as pid,
            null AS file_id,
            null AS guid,
            null AS file_name,
            null AS file_category,
            null AS file_type,
            null AS file_description,
            null AS file_size,
            null AS md5sum,
            st.study_id AS study_id,
            st.dbgap_accession as dbgap_accession,
            st.study_acronym as study_acronym,
            st.study_name as study_name,
            p.participant_id AS participant_id,
            null AS sample_id,
            null as files,
            null as combined_filters,
            COLLECT(DISTINCT {
                race: apoc.text.split(p.race, ';'),
                sex_at_birth: p.sex_at_birth
            }) AS participant_filters,
            COLLECT(DISTINCT {
                sample_anatomic_site: null,
                participant_age_at_collection: null,
                sample_tumor_status: null,
                tumor_classification: null,
                age_at_diagnosis: dg.age_at_diagnosis,
                diagnosis_anatomic_site: apoc.text.split(dg.anatomic_site, ';'),
                disease_phase: dg.disease_phase,
                diagnosis_classification_system: dg.diagnosis_classification_system,
                diagnosis_basis: dg.diagnosis_basis,
                tumor_grade_source: dg.tumor_grade_source,
                tumor_stage_source: dg.tumor_stage_source,
                diagnosis_classification: dg.diagnosis_classification
            }) AS sample_diagnosis_filters, 
            survival_filters as survival_filters,
            treatment_filters as treatment_filters,
            treatment_response_filters as treatment_response_filters,
            null AS library_selection,
            null AS library_source_material,
            null AS library_source_molecule,
            null AS library_strategy